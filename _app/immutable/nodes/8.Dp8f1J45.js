import"../chunks/DsnmJJEf.js";import"../chunks/Dreri0Nc.js";import{o as ee}from"../chunks/sDIuGG-g.js";import{p as re,l as Ut,a as ae,b as oe,g as t,m as N,s as l,c as u,d as a,r as i,u as T,f as p,n as D,t as vt,h as X}from"../chunks/BA9zlQXs.js";import{s as J}from"../chunks/CxGsrVHP.js";import{i as St}from"../chunks/5idYV8Eq.js";import{e as bt}from"../chunks/DHhalKro.js";import{f as c,a as n,c as xt,t as U}from"../chunks/D2T3iFuq.js";import{r as ct}from"../chunks/CN9_JMpm.js";import{b as pt}from"../chunks/j0kaSfka.js";import{i as se}from"../chunks/DVSe7J_H.js";import{a as lt,L as le,n as Pt}from"../chunks/BBUwg90z.js";import{B as nt}from"../chunks/dm43JwH2.js";import{c as ne}from"../chunks/BvDYI0fq.js";import{u as qt,C as s,P as Ct}from"../chunks/Xw1Er8YH.js";var ue=c("<!> <!>",1),ie=c("<!> <!>",1),de=c("<!> <!>",1),ve=c("<!> <!>",1),ce=c("<!> <!>",1),pe=c("<!> <!>",1),_e=c('<td><input type="text" class="input w-full"/></td> <td><input type="text" inputmode="decimal" pattern="[0-9]*" class="input w-full"/></td> <td><!></td> <td><!></td> <td><input type="text" inputmode="decimal" pattern="[0-9]*" class="input w-full"/></td> <td> </td> <td class="space-x-2"><!> <!></td>',1),$e=c('<td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td class="space-x-2"><!> <!></td>',1),fe=c("<tr><!></tr>"),he=c("<!> <!>",1),me=c("<!> <!>",1),ge=c("<!> <!>",1),be=c("<!> <!>",1),Pe=c("<!> <!>",1),xe=c("<!> <!>",1),Ce=c('<tr><td><input type="text" class="input w-full" placeholder="Nama Rute"/></td><td><input type="text" inputmode="decimal" pattern="[0-9]*" class="input w-full" placeholder="Jarak"/></td><td><!></td><td><!></td><td><input type="text" inputmode="decimal" pattern="[0-9]*" class="input w-full" placeholder="Buffer"/></td><td>-</td><td><!> <!></td></tr>'),ke=c('<tr><td colspan="7"><!></td></tr>'),we=c('<div class="fixed inset-0 bg-white/70 flex items-center justify-center z-50"><!></div>'),ye=c('<div class="table-wrap"><table class="table caption-bottom"><thead><tr><th>Rute</th><th>Jarak</th><th>Supervisor</th><th>Tipe Rute</th><th>Buffer</th><th>File</th><th>Action</th></tr></thead><tbody><!><!></tbody></table> <!></div>');function Ge(At,Gt){re(Gt,!1);const _t=N(),$t=N();let ut=N(!1),S=[],y=N([]),A=N([]),Q=N([]),Y=N(null),ft=N(null),o=N(null);ee(async()=>{const e=await lt.getRute();a(Q,e.rutes??[]),S=(await lt.getSupervisor()).users??[],a(y,S)});const Vt=()=>{a(y,S)},Lt=e=>{const r=(e.inputValue??"").toLowerCase(),v=t(A)?.[0],R=(S.find($=>String($.user_id)===String(v))?.nama??"").toLowerCase();if(!r||r===R){a(y,S);return}const W=S.filter($=>($.nama??"").toLowerCase().includes(r));a(y,W.length?W:S)},Ot=e=>{a(A,e.value??[]),t(o)&&X(o,t(o).user_id=t(A)?.[0]?t(A)[0]:null),a(y,S)},G=[{value:"road",label:"Jalan"},{value:"field",label:"Site"},{value:"traffic",label:"Lalu lintas"}];let V=N(G),Z=N([]);const jt=()=>{a(V,G)},Bt=e=>{const r=(e.inputValue??"").toLowerCase();if(!r){a(V,G);return}a(V,G.filter(v=>v.label.toLowerCase().includes(r)))},Et=e=>{a(Z,e.value??[]),t(o)&&X(o,t(o).tipe_rute=t(Z)?.[0]??null),a(V,G)},Ht=e=>G.find(v=>v.value===e)?.label??"-",zt=e=>{a(Y,"edit"),a(ft,e.rute_id),a(o,{rute_id:e.rute_id,nama_rute:e.nama_rute??"",jarak:e.jarak??"",user_id:e.user_id??null,tipe_rute:e.tipe_rute??null,buffer:e.buffer??""}),a(A,t(o).user_id?[String(t(o).user_id)]:[]),a(Z,t(o).tipe_rute?[String(t(o).tipe_rute)]:[]),a(y,S),a(V,G)},kt=()=>{a(Y,null),a(ft,null),a(o,null),a(A,[]),a(Z,[]),a(y,S),a(V,G)},Nt=async()=>{if(a(ut,!0),!!t(o)){try{const e={rute_id:t(o).rute_id,nama_rute:t(o).nama_rute,jarak:t(o).jarak,user_id:t(o).user_id,tipe_rute:t(o).tipe_rute,buffer:Number(t(o).buffer)};if(t(Y)==="edit"){const r=await lt.updateRute(e);Pt.success("Perubahan rute berhasil disimpan.");const I=(await lt.getRuteByID({rute_id:e.rute_id})).rute;a(Q,t(Q).map(R=>R.rute_id!==I.rute_id?R:{...I}))}else{const r=await lt.createRute(e);Pt.success("Rute baru berhasil ditambahkan.");const I=(await lt.getLastRute()).rute;a(Q,[...t(Q),I])}}catch(e){Pt.error("Gagal menyimpan perubahan rute."),console.error("Error updating rute:",e),a(ut,!1);return}finally{a(ut,!1)}kt()}};async function Ft(e){if(await ne("Hapus data ini?")){a(ut,!0);try{await lt.deleteRute({rute_id:e}),a(Q,t(Q).filter(v=>v.rute_id!==e))}catch(v){console.error("Error deleting rute:",v),Pt?.error("Gagal menghapus rute")}finally{Pt?.success("Rute berhasil dihapus")}a(ut,!1)}}const Mt=()=>{a(Y,"add"),a(ft,null),a(o,{nama_rute:"",jarak:"",user_id:null,tipe_rute:null,buffer:""}),a(A,[]),a(Z,[]),a(y,S),a(V,G)};Ut(()=>t(y),()=>{a(_t,qt({items:t(y),itemToString:e=>e.nama,itemToValue:e=>String(e.user_id)}))}),Ut(()=>t(V),()=>{a($t,qt({items:t(V),itemToString:e=>e.label,itemToValue:e=>e.value}))}),ae(),se();var wt=ye(),yt=u(wt),Dt=l(u(yt)),Jt=u(Dt);bt(Jt,1,()=>t(Q),e=>e.rute_id,(e,r)=>{var v=fe(),I=u(v);{var R=$=>{var tt=_e(),L=p(tt),it=u(L);ct(it),i(L);var O=l(L,2),et=u(O);ct(et),i(O);var q=l(O,2),dt=u(q);s(dt,{class:"w-48",placeholder:"Pilih Supervisor",get collection(){return t(_t)},onOpenChange:Vt,onInputValueChange:Lt,onValueChange:Ot,get value(){return t(A)},multiple:!1,inputBehavior:"autohighlight",openOnClick:!0,children:(d,x)=>{var f=de(),B=p(f);s.Control(B,{$$events:{click:()=>t(_t)?.open?.()},children:(h,E)=>{var C=ue(),F=p(C);s.Input(F,{});var k=l(F,2);s.Trigger(k,{}),n(h,C)},$$slots:{default:!0}});var at=l(B,2);Ct(at,{children:(h,E)=>{s.Positioner(h,{children:(C,F)=>{s.Content(C,{class:"bg-white border shadow max-h-40 overflow-y-auto",children:(k,ot)=>{var M=xt(),st=p(M);bt(st,1,()=>t(y),K=>K.user_id,(K,w)=>{s.Item(K,{get item(){return t(w)},children:(It,Zt)=>{var ht=ie(),mt=p(ht);s.ItemText(mt,{children:(Tt,te)=>{D();var gt=U();vt(()=>J(gt,(t(w),T(()=>t(w).nama)))),n(Tt,gt)},$$slots:{default:!0}});var Rt=l(mt,2);s.ItemIndicator(Rt,{}),n(It,ht)},$$slots:{default:!0}})}),n(k,M)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),n(d,f)},$$slots:{default:!0}}),i(q);var H=l(q,2),_=u(H);s(_,{class:"w-48",placeholder:"Pilih Tipe Rute",get collection(){return t($t)},onOpenChange:jt,onInputValueChange:Bt,onValueChange:Et,get value(){return t(Z)},multiple:!1,inputBehavior:"autohighlight",openOnClick:!0,children:(d,x)=>{var f=pe(),B=p(f);s.Control(B,{$$events:{click:()=>t($t)?.open?.()},children:(h,E)=>{var C=ve(),F=p(C);s.Input(F,{});var k=l(F,2);s.Trigger(k,{}),n(h,C)},$$slots:{default:!0}});var at=l(B,2);Ct(at,{children:(h,E)=>{s.Positioner(h,{children:(C,F)=>{s.Content(C,{class:"bg-white border shadow max-h-40 overflow-y-auto",children:(k,ot)=>{var M=xt(),st=p(M);bt(st,1,()=>t(V),K=>K.value,(K,w)=>{s.Item(K,{get item(){return t(w)},children:(It,Zt)=>{var ht=ce(),mt=p(ht);s.ItemText(mt,{children:(Tt,te)=>{D();var gt=U();vt(()=>J(gt,(t(w),T(()=>t(w).label)))),n(Tt,gt)},$$slots:{default:!0}});var Rt=l(mt,2);s.ItemIndicator(Rt,{}),n(It,ht)},$$slots:{default:!0}})}),n(k,M)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),n(d,f)},$$slots:{default:!0}}),i(H);var j=l(H,2),m=u(j);ct(m),i(j);var g=l(j,2),rt=u(g,!0);i(g);var b=l(g,2),z=u(b);nt(z,{severity:"success",$$events:{click:Nt},children:(d,x)=>{D();var f=U("Simpan");n(d,f)},$$slots:{default:!0}});var P=l(z,2);nt(P,{severity:"danger",$$events:{click:kt},children:(d,x)=>{D();var f=U("Batal");n(d,f)},$$slots:{default:!0}}),i(b),vt(()=>J(rt,(t(r),T(()=>t(r).path||"-")))),pt(it,()=>t(o).nama_rute,d=>X(o,t(o).nama_rute=d)),pt(et,()=>t(o).jarak,d=>X(o,t(o).jarak=d)),pt(m,()=>t(o).buffer,d=>X(o,t(o).buffer=d)),n($,tt)},W=$=>{var tt=$e(),L=p(tt),it=u(L,!0);i(L);var O=l(L,2),et=u(O,!0);i(O);var q=l(O,2),dt=u(q,!0);i(q);var H=l(q,2),_=u(H,!0);i(H);var j=l(H,2),m=u(j,!0);i(j);var g=l(j,2),rt=u(g,!0);i(g);var b=l(g,2),z=u(b);nt(z,{severity:"success",$$events:{click:()=>zt(t(r))},children:(d,x)=>{D();var f=U("Edit");n(d,f)},$$slots:{default:!0}});var P=l(z,2);nt(P,{severity:"danger",$$events:{click:()=>{Ft(t(r).rute_id)}},children:(d,x)=>{D();var f=U("Hapus");n(d,f)},$$slots:{default:!0}}),i(b),vt(d=>{J(it,(t(r),T(()=>t(r).nama_rute))),J(et,(t(r),T(()=>t(r).jarak))),J(dt,(t(r),T(()=>t(r).user_id?t(r).supervisor?.nama:"-"))),J(_,d),J(m,(t(r),T(()=>t(r).buffer||"-"))),J(rt,(t(r),T(()=>t(r).path||"-")))},[()=>(t(r),T(()=>t(r).tipe_rute?Ht(t(r).tipe_rute):"-"))]),n($,tt)};St(I,$=>{t(Y),t(ft),t(r),t(o),T(()=>t(Y)==="edit"&&t(ft)===t(r).rute_id&&t(o))?$(R):$(W,!1)})}i(v),n(e,v)});var Kt=l(Jt);{var Qt=e=>{var r=Ce(),v=u(r),I=u(v);ct(I),i(v);var R=l(v),W=u(R);ct(W),i(R);var $=l(R),tt=u($);s(tt,{class:"w-48",placeholder:"Pilih Supervisor",get collection(){return t(_t)},onOpenChange:Vt,onInputValueChange:Lt,onValueChange:Ot,get value(){return t(A)},multiple:!1,inputBehavior:"autohighlight",openOnClick:!0,children:(_,j)=>{var m=ge(),g=p(m);s.Control(g,{$$events:{click:()=>t(_t)?.open?.()},children:(b,z)=>{var P=he(),d=p(P);s.Input(d,{});var x=l(d,2);s.Trigger(x,{}),n(b,P)},$$slots:{default:!0}});var rt=l(g,2);Ct(rt,{children:(b,z)=>{s.Positioner(b,{children:(P,d)=>{s.Content(P,{class:"bg-white border shadow max-h-40 overflow-y-auto",children:(x,f)=>{var B=xt(),at=p(B);bt(at,1,()=>t(y),h=>h.user_id,(h,E)=>{s.Item(h,{get item(){return t(E)},children:(C,F)=>{var k=me(),ot=p(k);s.ItemText(ot,{children:(st,K)=>{D();var w=U();vt(()=>J(w,(t(E),T(()=>t(E).nama)))),n(st,w)},$$slots:{default:!0}});var M=l(ot,2);s.ItemIndicator(M,{}),n(C,k)},$$slots:{default:!0}})}),n(x,B)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),n(_,m)},$$slots:{default:!0}}),i($);var L=l($),it=u(L);s(it,{class:"w-48",placeholder:"Pilih Tipe Rute",get collection(){return t($t)},onOpenChange:jt,onInputValueChange:Bt,onValueChange:Et,get value(){return t(Z)},multiple:!1,inputBehavior:"autohighlight",openOnClick:!0,children:(_,j)=>{var m=xe(),g=p(m);s.Control(g,{$$events:{click:()=>t($t)?.open?.()},children:(b,z)=>{var P=be(),d=p(P);s.Input(d,{});var x=l(d,2);s.Trigger(x,{}),n(b,P)},$$slots:{default:!0}});var rt=l(g,2);Ct(rt,{children:(b,z)=>{s.Positioner(b,{children:(P,d)=>{s.Content(P,{class:"bg-white border shadow max-h-40 overflow-y-auto",children:(x,f)=>{var B=xt(),at=p(B);bt(at,1,()=>t(V),h=>h.value,(h,E)=>{s.Item(h,{get item(){return t(E)},children:(C,F)=>{var k=Pe(),ot=p(k);s.ItemText(ot,{children:(st,K)=>{D();var w=U();vt(()=>J(w,(t(E),T(()=>t(E).label)))),n(st,w)},$$slots:{default:!0}});var M=l(ot,2);s.ItemIndicator(M,{}),n(C,k)},$$slots:{default:!0}})}),n(x,B)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),n(_,m)},$$slots:{default:!0}}),i(L);var O=l(L),et=u(O);ct(et),i(O);var q=l(O,2),dt=u(q);nt(dt,{severity:"success",$$events:{click:Nt},children:(_,j)=>{D();var m=U("Simpan");n(_,m)},$$slots:{default:!0}});var H=l(dt,2);nt(H,{severity:"danger",$$events:{click:kt},children:(_,j)=>{D();var m=U("Batal");n(_,m)},$$slots:{default:!0}}),i(q),i(r),pt(I,()=>t(o).nama_rute,_=>X(o,t(o).nama_rute=_)),pt(W,()=>t(o).jarak,_=>X(o,t(o).jarak=_)),pt(et,()=>t(o).buffer,_=>X(o,t(o).buffer=_)),n(e,r)},Wt=e=>{var r=ke(),v=u(r),I=u(v);nt(I,{severity:"success",$$events:{click:Mt},children:(R,W)=>{D();var $=U("+ Tambah");n(R,$)},$$slots:{default:!0}}),i(v),i(r),n(e,r)};St(Kt,e=>{t(Y)==="add"?e(Qt):e(Wt,!1)})}i(Dt),i(yt);var Xt=l(yt,2);{var Yt=e=>{var r=we(),v=u(r);le(v,{}),i(r),n(e,r)};St(Xt,e=>{t(ut)&&e(Yt)})}i(wt),n(At,wt),oe()}export{Ge as component};
